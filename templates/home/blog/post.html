{% extends "layouts/home.html" %}

{% block title %}{{ parent() }} - Blog{% endblock %}

{% block view %}
<div id="blog-post" class="">
    {% if post.cover %}
    <div id="blog-cover" style="background-image: url('{{ post.cover }}');">
        &nbsp;
    </div>
    {% endif %}
    <div class="pt-3">
        <h1>{{ post.title }}</h1>
        <h4>{{ post.subtitle }}</h4>
        <span>
            <small class="text-muted"> {{ post.read_min }} min read</small><br />
            <small class="text-muted"> Last Updated  {{ post.ago }}</small>
        </span>
        <hr class="mt-4">
        <div id="blog-content" class="mt-4">
            {{ post.content|raw }}
        </div>
        {% if post.comments_enabled %}
            <div id="blog-comments">
                <hr>
                {% include "components/flash.html" %}
                <div id="pre-comment" onClick="hideBlogPreComment(); showBlogComment();">
                    <label class="my-2" for="name">Post comment</label>
                    <input class="form-control" type="text" placeholder="Write your comment here" />
                </div>
                <div id="comment-section" style="display: none;">
                    <form method="POST" hx-post="/blog/comment/{{ post.id }}" hx-swap="outerHTML" hx-target="#blog-comments" hx-select="#blog-comments">
                        {{ csrf()|raw }}
                        <div>
                            <label class="my-2" for="name">Post comment</label>
                            <textarea class="form-control" style="height: 200px;" placeholder="Write your comment here" id="comment" name="comment" style="height: 100px" autofocus required></textarea>
                            {% include 'errors/validation.html' with {'validate': 'comment'} %}
                        </div>
                        <div>
                            <label class="my-2" for="name">Your name</label>
                            <input type="name" class="form-control" id="name" name="name" placeholder="Full name" required>
                            {% include 'errors/validation.html' with {'validate': 'name'} %}
                        </div>
                        <div class="mt-3">
                            <p class="mb-1">Please enter the code to confirm you're not a robot.</p>
                            <div class="captcha d-flex">
                                <span class="bg-blue"><img src="/captcha" /></span>
                                <input class="form-control rounded-0" maxlength="4" name="captcha" type="tel" name="captcha" value="" required /><br />
                            </div>
                            {% include 'errors/validation.html' with {'validate': 'captcha'} %}
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-success text-white">
                                Send
                            </button>
                        </div>
                    </form>
                </div>
                <div id="comments" hx-trigger="load" hx-get="/blog/comments/{{ post.id }}" hx-swap="outerHTML" hx-target="#comments" hx-select="#comments">
                </div>
            </div>
        {% endif %}
    </div>
</div>
<script>
    const showBlogComment = () => {
        var comment_section = document.getElementById("comment-section");
        var comment = document.getElementById("comment");
        comment_section.style.display = 'block';
        comment.focus();
    }
    const hideBlogComment = () => {
        var comment_section = document.getElementById("comment-section");
        comment_section.style.display = 'none';
    }
    const hideBlogPreComment = () => {
        var pre_comment = document.getElementById("pre-comment");
        pre_comment.style.display = 'none';
    }
</script>
{% endblock %}
